<div th:fragment="bandSettingFragment">
  <!-- âœ… ë¦¬ë”ì¼ ê²½ìš°ë§Œ: ë°´ë“œ ì •ë³´ ìˆ˜ì • í¼ + ì´ë¯¸ì§€ ì—…ë¡œë“œ -->
  <div th:if="${isLeader}">
    <div class="card mb-4">
      <div class="card-header">ë°´ë“œ ì •ë³´ ìˆ˜ì •</div>
      <div class="card-body">
        <!-- í”„ë¡œí•„ ì´ë¯¸ì§€ + ì—…ë¡œë“œ -->
        <div class="mb-4 text-center">
          <img id="preview-image"
               th:src="${band.profileImg == null} ? '/images/band/band_profile.png' : ${band.profileImg}" alt="í”„ë¡œí•„ ì´ë¯¸ì§€"
               class="rounded border" style="width: 120px; height: 120px; object-fit: cover;">
          <div class="mt-2">
            <form th:object="${bandProfileForm}" onsubmit="return checkProfileImage();" th:action="@{|/band/upload/profile/${band.id}|}" method="post" enctype="multipart/form-data">
              <input id="image-input" th:field="*{profileImg}" type="file" name="profileImage" class="form-control form-control-sm mb-2" style="max-width: 300px; margin: 0 auto;">
              <button type="submit" class="btn btn-sm btn-outline-primary">í”„ë¡œí•„ ì‚¬ì§„ ì—…ë¡œë“œ</button>
            </form>
          </div>
        </div>

        <!-- ì…ë ¥ í¼ -->
        <form th:object="${bandForm}" th:action="@{|/band/update/${band.id}|}" method="post">
          <div class="mb-3">
            <label class="form-label">ë°´ë“œ ì´ë¦„</label>
            <input type="text" th:field="*{bandName}" class="form-control form-control-sm" required>
          </div>

          <div class="mb-3">
            <label class="form-label">ì§€ì—­</label>
            <p th:text="${band.regionName}" class="form-control form-control-sm">
          </div>

          <div class="mb-3">
            <label class="form-label">ì„ í˜¸ ì¥ë¥´</label>
            <select name="genre" class="form-select form-select-sm">
              <option th:each="genre : ${genreList}" th:value="${genre}" th:text="${genre.displayName}"
                      th:selected="${genre == currentGenre}"
              ></option>
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label">ê°€ì… ì§ˆë¬¸</label>
            <textarea class="form-control form-control-sm" rows="2" th:field="*{question}" required></textarea>
          </div>

          <button type="submit" class="btn btn-primary btn-sm">ë°´ë“œ ì •ë³´ ìˆ˜ì •</button>
        </form>
      </div>
    </div>
  </div>

  <!-- ğŸ”» ë°´ë“œ íƒˆí‡´ / ì‚­ì œ ì¹´ë“œ -->
  <div class="card border-danger">
    <div class="card-header text-danger">ë°´ë“œ ì„¤ì •</div>
    <div class="card-body">
      <p class="text-muted mb-3" th:if="${isLeader}">
        ë°´ë“œë¥¼ íƒˆí‡´í•˜ê±°ë‚˜ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‚­ì œ ì‹œ ëª¨ë“  ì •ë³´ê°€ ì‚¬ë¼ì§‘ë‹ˆë‹¤.
      </p>
      <p class="text-muted mb-3" th:unless="${isLeader}">
        ë°´ë“œë¥¼ íƒˆí‡´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‚­ì œëŠ” ë¦¬ë”ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.
      </p>

      <!-- ğŸ”˜ ë°´ë“œ íƒˆí‡´ ë²„íŠ¼ (ëª¨ë‹¬ ë„ì›€) -->
      <button type="button" class="btn btn-outline-secondary btn-sm me-2" data-bs-toggle="modal" data-bs-target="#quitBandModal">
        ë°´ë“œ íƒˆí‡´
      </button>

      <!-- ğŸ” ë°´ë“œ ì‚­ì œ ë²„íŠ¼ (ë¦¬ë”ë§Œ, ëª¨ë‹¬ ë„ì›€) -->
      <button type="button" th:if="${isLeader}" class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteBandModal">
        ë°´ë“œ ì‚­ì œ
      </button>
    </div>
  </div>

  <!-- âœ… ë°´ë“œ íƒˆí‡´ ëª¨ë‹¬ -->
  <div class="modal fade" id="quitBandModal" tabindex="-1" aria-labelledby="quitBandModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">

        <div class="modal-header">
          <h5 class="modal-title" id="quitBandModalLabel">ë°´ë“œ íƒˆí‡´ í™•ì¸</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body">
          ì •ë§ ë°´ë“œë¥¼ íƒˆí‡´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?<br>ë°´ë“œë¥¼ íƒˆí‡´í•˜ë©´ í™œë™ ê¸°ë¡ê³¼ ì—°ê²°ì´ í•´ì œë©ë‹ˆë‹¤.
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
          <a th:href="@{|/band/quit/${band.id}|}">
            <button type="submit" class="btn btn-outline-danger">íƒˆí‡´í•˜ê¸°</button>
          </a>
        </div>

      </div>
    </div>
  </div>

  <!-- âœ… ë°´ë“œ ì‚­ì œ ëª¨ë‹¬ (ë¦¬ë” ì „ìš©) -->
  <div class="modal fade" id="deleteBandModal" tabindex="-1" aria-labelledby="deleteBandModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">

        <div class="modal-header">
          <h5 class="modal-title" id="deleteBandModalLabel">ë°´ë“œ ì‚­ì œ í™•ì¸</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body text-danger">
          ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br><strong>ì •ë§ ë°´ë“œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</strong><br>
          ëª¨ë“  ê²Œì‹œë¬¼ê³¼ êµ¬ì„±ì›ì´ ì‚­ì œë©ë‹ˆë‹¤.
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
          <a th:href="@{|/band/delete/${band.id}|}">
            <button type="submit" class="btn btn-danger">ì‚­ì œí•˜ê¸°</button>
          </a>
        </div>

      </div>
    </div>
  </div>

  <script>
    function checkProfileImage() {
   const fileInput = document.getElementById('image-input');
   if (!fileInput.files || fileInput.files.length === 0) {
     alert('ì´ë¯¸ì§€ íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
     return false;
   }
   return true;
 }

   document.getElementById('image-input').addEventListener('change', function (e) {
     const file = e.target.files[0];
     const preview = document.getElementById('preview-image');

     if (file) {
       const reader = new FileReader();

       reader.onload = function (e) {
         preview.src = e.target.result;
       };

       reader.readAsDataURL(file);
     }
   });
  </script>
</div>